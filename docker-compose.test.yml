services:
  sftp:
    image: atmoz/sftp:latest
    ports:
      - "2222:22"
    environment:
      SFTP_USERS: testuser:testpass:1001:100:upload
    volumes:
      - sftp-data:/home/testuser/upload
    healthcheck:
      test: ["CMD", "pgrep", "sshd"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 15s

  ftp:
    image: fauria/vsftpd:latest
    ports:
      - "21:21"
      - "21000-21010:21000-21010"
    environment:
      FTP_USER: testuser
      FTP_PASS: testpass
      PASV_ADDRESS: localhost
      PASV_MIN_PORT: 21000
      PASV_MAX_PORT: 21010
    volumes:
      - ftp-data:/home/vsftpd
    healthcheck:
      test: ["CMD", "pgrep", "vsftpd"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 15s

  localstack:
    image: localstack/localstack:latest
    ports:
      - "4566:4566"
    environment:
      SERVICES: s3
      DEBUG: 0
      EDGE_PORT: 4566
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4566/_localstack/health"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 30s

  webdav:
    image: hacdias/webdav:latest
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./webdav-config.yml:/config.yml:ro
    command: ["--config", "/config.yml"]
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider --user=testuser --password=testpass http://localhost:80/ || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 30s

volumes:
  sftp-data:
  ftp-data:
